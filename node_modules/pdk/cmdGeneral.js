var x=exports,
   fs = require('fs'),
   DoCmd=x.DoCmd=function(cm,S,s,ls){
      var n=cm.nam,n=n?n:cm.S;
      if(0){}
      else if(n=='cd')CD(cm,S,s,ls);
      else if(n=='cls')Cls(cm,S,s,ls);
      else if(n=='dir')Dir(cm,S,s,ls);
      else if(n=='exit'){}
      else return false;
      return true;
   },
   CD=function(cm){
      var d=cm.args.length?cm.args[0].val:'.';
      try{process.chdir(d);}catch(err){cout('"'+d+'" does not exists');};
      DoMain();
   },
   Cls=function(){console.Cls();DoMain();},
   Dir=function(cm,S,s,ls){
      var st;cd=process.cwd();
      cout(' Listing Contents of '+cd+'\n');
      fs.readdir(cd,function(err,f){
         f.cur=0;f.cd=cd;
         if(f.length){
            var fn=f.fn=function(err,stat){
               var t=this,z,fn=t.fn,st,dt=require('pops/pops.date.js');

               if(err){DoMain();return;};
               st=dt(stat.mtime, "mm/dd/yyyy  hh:MM TT")+'  ';//hh:MM:ss
               if(stat.isDirectory())st+='  <DIR>         ';
               else st+='  '+(stat.size.Proper()+'b').PadL(14);
               
               st+='  '+f[t.cur];
               console.log(st);
               t.cur++;
               if(t.cur<f.length){fs.stat(t.cd+'\\'+f[t.cur],t.fn)}
               else{
                  cout('\n      '+f.length+' Item(s)\n');
                  DoMain();
               };
            }.bind(f);
            
            fs.stat(cd+'\\'+f[0],fn);
         
         }
         else{
            cout('\n      0 Item(s)\n');
            DoMain();
         };
      });
   }

;

